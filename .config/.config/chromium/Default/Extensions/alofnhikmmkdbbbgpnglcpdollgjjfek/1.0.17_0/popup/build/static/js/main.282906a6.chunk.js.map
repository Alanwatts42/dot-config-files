{"version":3,"sources":["bridge.js","led_red.png","led_green.png","led_orange.png","randomClipperPort.js","App.js","index.js"],"names":["randomClipperPort","require","bridge_","Bridge","Object","_Users_tessus_data_work_joplin_Clipper_joplin_webclipper_popup_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_2__","this","nounce_","Date","now","browser","browserSupportsPromises","dispatch","console","info","browser_","dispatch_","browserSupportsPromises_","clipperServerPort_","clipperServerPortStatus_","browser_notify","_ref","_Users_tessus_data_work_joplin_Clipper_joplin_webclipper_popup_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__","_Users_tessus_data_work_joplin_Clipper_joplin_webclipper_popup_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default","a","mark","_callee","command","content","wrap","_context","prev","next","warning","warn","_this","type","text","name","title","body_html","html","base_url","source_url","url","parent_id","tags","image_sizes","anchor_names","value","stop","_x4","apply","arguments","runtime","onMessage","addListener","backgroundPage","env_","joplinEnv","env","findClipperServerPort","bgp","extension","getBackgroundPage","Promise","resolve","reject","action","state","_this2","scheduleStateSaveIID","clearTimeout","setTimeout","toSave","selectedFolderId","storageSet","storageGet","s","id","foundState","i","port","fetch","response","trim","folderTree","folders","clipperApiExec","bridge","restoreState","checkStatus","_this3","Error","operation","searchingClipperServer","waitIID","setInterval","clearInterval","clipperServerPort","options","tabs","executeScript","_this4","e","lastError","msg","JSON","stringify","message","push","join","query","_this5","tabId","sendMessage","_this6","result","create","_this7","keys","storage","local","set","_this8","defaultValue","get","r","_this9","tabsQuery","active","currentWindow","length","tabsSendMessage","method","path","body","clipperServerBaseUrl","baseUrl","fetchOptions","headers","Content-Type","queryString","k","hasOwnProperty","encodeURIComponent","ok","json","uploading","nounce","success","_context17","t0","errorMessage","module","exports","startPort","offset","connect","PreviewComponent","classCallCheck","possibleConstructorReturn","getPrototypeOf","call","bodyRef","React","createRef","imgs","current","getElementsByTagName","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Symbol","iterator","done","img","width","height","err","return","react_default","createElement","className","onClick","props","onConfirmClick","onChange","onTitleChange","ref","dangerouslySetInnerHTML","__html","PureComponent","AppComponent","contentScriptLoaded","selectedTags","contentScriptError","confirm_click","assign","clippedContent","sendContentToJoplin","contentTitle_change","event","currentTarget","clipSimplified_click","sendCommandToActiveTab","clipComplete_click","clipSelection_click","clipUrl_click","clipScreenshot_click","asyncToGenerator","regenerator_default","sent","api_base_url","window","close","clipperServerHelpLink_click","tabsCreate","folderSelect_change","target","tagCompChanged","bind","assertThisInitialized","onAddTagClick","onClearTagButtonClick","newTags","slice","setState","focusNewTagInput_","index","getAttribute","splice","Number","tabsExecuteScript","file","loadContentScripts","error","_context3","foundSelectedFolderId","searchSelectedFolder","folder","children","newFolderId","lastRef","refs","focus","style","padding","fontSize","maxWidth","warningComponent","hasContent","previewComponent","contentUploadOperation","App_PreviewComponent","tagDataListOptions","tag","key","simplifiedPageButtonLabel","simplifiedPageButtonTooltip","isProbablyReaderable","optionComps","addOptions","depth","repeat","replace","foldersComp","comps","data-index","list","onInput","href","tagsComp","led","helpLink","clipperServer","led_green","charAt","toUpperCase","led_orange","led_red","alt","src","clipperStatusComp","Component","App","Provider","createStore","applyMiddleware","defaultState","reduxMiddleware","store","newState","getState","indexOf","scheduleStateSave","abrupt","_x","reducer","newContent","_callee2","_context2","init","chrome","ReactDOM","render","src_App","document","getElementById","main","catch"],"mappings":"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","file":"static/js/main.282906a6.chunk.js","sourcesContent":["const randomClipperPort = require('./randomClipperPort');\n\nclass Bridge {\n\n\tconstructor() {\n\t\tthis.nounce_ = Date.now();\n\t}\n\n\tasync init(browser, browserSupportsPromises, dispatch) {\n\t\tconsole.info('Popup: Init bridge');\n\n\t\tthis.browser_ = browser;\n\t\tthis.dispatch_ = dispatch;\n\t\tthis.browserSupportsPromises_ = browserSupportsPromises;\n\t\tthis.clipperServerPort_ = null;\n\t\tthis.clipperServerPortStatus_ = 'searching';\n\n\t\tthis.browser_notify = async (command) => {\n\t\t\tconsole.info('Popup: Got command:', command);\n\t\t\t\n\t\t\tif (command.warning) {\n\t\t\t\tconsole.warn('Popup: Got warning: ' + command.warning);\n\t\t\t\tthis.dispatch({ type: 'WARNING_SET', text: command.warning });\n\t\t\t} else {\n\t\t\t\tthis.dispatch({ type: 'WARNING_SET', text: '' });\n\t\t\t}\n\n\t\t\tif (command.name === 'clippedContent') {\n\t\t\t\tconst content = {\n\t\t\t\t\ttitle: command.title,\n\t\t\t\t\tbody_html: command.html,\n\t\t\t\t\tbase_url: command.base_url,\n\t\t\t\t\tsource_url: command.url,\n\t\t\t\t\tparent_id: command.parent_id,\n\t\t\t\t\ttags: command.tags || '',\n\t\t\t\t\timage_sizes: command.image_sizes || {},\n\t\t\t\t\tanchor_names: command.anchor_names || [],\n\t\t\t\t};\n\n\t\t\t\tthis.dispatch({ type: 'CLIPPED_CONTENT_SET', content: content });\n\t\t\t}\n\n\t\t\tif (command.name === 'isProbablyReaderable') {\n\t\t\t\tthis.dispatch({ type: 'IS_PROBABLY_READERABLE', value: command.value });\n\t\t\t}\n\t\t}\n\n\t\tthis.browser_.runtime.onMessage.addListener(this.browser_notify);\n\n\t\tconst backgroundPage = await this.backgroundPage(this.browser_);\n\n\t\t// Not sure why the getBackgroundPage() sometimes returns null, so\n\t\t// in that case default to \"prod\" environment, which means the live\n\t\t// extension won't be affected by this bug.\n\t\tthis.env_ = backgroundPage ? backgroundPage.joplinEnv() : 'prod';\n\n\t\tconsole.info('Popup: Env:', this.env());\n\n\t\tthis.dispatch({\n\t\t\ttype: 'ENV_SET',\n\t\t\tenv: this.env(),\n\t\t});\n\n\t\tthis.findClipperServerPort();\n\t}\n\n\tasync backgroundPage(browser) {\n\t\tconst bgp = browser.extension.getBackgroundPage();\n\t\tif (bgp) return bgp;\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tbrowser.runtime.getBackgroundPage((bgp) => {\n\t\t\t\tresolve(bgp);\n\t\t\t})\n\t\t});\n\t}\n\n\tenv() {\n\t\treturn this.env_;\n\t}\n\n\tbrowser() {\n\t\treturn this.browser_;\n\t}\n\n\tdispatch(action) {\n\t\treturn this.dispatch_(action);\n\t}\n\n\tscheduleStateSave(state) {\n\t\tif (this.scheduleStateSaveIID) {\n\t\t\tclearTimeout(this.scheduleStateSaveIID);\n\t\t\tthis.scheduleStateSaveIID = null;\n\t\t}\n\n\t\tthis.scheduleStateSaveIID = setTimeout(() => {\n\t\t\tthis.scheduleStateSaveIID = null;\n\n\t\t\tconst toSave = {\n\t\t\t\tselectedFolderId: state.selectedFolderId,\n\t\t\t};\n\n\t\t\tconsole.info('Popup: Saving state', toSave);\n\n\t\t\tthis.storageSet(toSave);\n\t\t}, 100);\n\t}\n\n\tasync restoreState() {\n\t\tconst s = await this.storageGet(null);\n\t\tconsole.info('Popup: Restoring saved state:', s);\n\t\tif (!s) return;\n\n\t\tif (s.selectedFolderId) this.dispatch({ type: 'SELECTED_FOLDER_SET', id: s.selectedFolderId });\n\t}\n\n\tasync findClipperServerPort() {\n\t\tthis.dispatch({ type: 'CLIPPER_SERVER_SET', foundState: 'searching' });\n\n\t\tlet state = null;\n\t\tfor (let i = 0; i < 10; i++) {\n\t\t\tstate = randomClipperPort(state, this.env());\n\n\t\t\ttry {\n\t\t\t\tconsole.info('findClipperServerPort: Trying ' + state.port); \n\t\t\t\tconst response = await fetch('http://127.0.0.1:' + state.port + '/ping');\n\t\t\t\tconst text = await response.text();\n\t\t\t\tconsole.info('findClipperServerPort: Got response: ' + text);\n\t\t\t\tif (text.trim() === 'JoplinClipperServer') {\n\t\t\t\t\tthis.clipperServerPortStatus_ = 'found';\n\t\t\t\t\tthis.clipperServerPort_ = state.port;\n\t\t\t\t\tthis.dispatch({ type: 'CLIPPER_SERVER_SET', foundState: 'found', port: state.port });\n\n\t\t\t\t\tconst folders = await this.folderTree();\n\t\t\t\t\tthis.dispatch({ type: 'FOLDERS_SET', folders: folders });\n\n\t\t\t\t\tconst tags = await this.clipperApiExec('GET', 'tags');\n\t\t\t\t\tthis.dispatch({ type: 'TAGS_SET', tags: tags });\n\n\t\t\t\t\tbridge().restoreState();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\t// continue\n\t\t\t}\n\t\t}\n\n\t\tthis.clipperServerPortStatus_ = 'not_found';\n\n\t\tthis.dispatch({ type: 'CLIPPER_SERVER_SET', foundState: 'not_found' });\n\n\t\treturn null;\n\t}\n\n\tasync clipperServerPort() {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst checkStatus = () => {\n\t\t\t\tif (this.clipperServerPortStatus_ === 'not_found') {\n\t\t\t\t\treject(new Error('Could not find clipper service. Please make sure that Joplin is running and that the clipper server is enabled.'));\n\t\t\t\t\treturn true;\n\t\t\t\t} else if (this.clipperServerPortStatus_ === 'found') {\n\t\t\t\t\tresolve(this.clipperServerPort_);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (checkStatus()) return;\n\n\t\t\tthis.dispatch({ type: 'CONTENT_UPLOAD', operation: { searchingClipperServer: true } });\n\n\t\t\tconst waitIID = setInterval(() => {\n\t\t\t\tif (!checkStatus()) return;\n\t\t\t\tthis.dispatch({ type: 'CONTENT_UPLOAD', operation: null });\n\t\t\t\tclearInterval(waitIID);\n\t\t\t}, 1000);\n\t\t});\n\t}\n\n\tasync clipperServerBaseUrl() {\n\t\tconst port = await this.clipperServerPort();\n\t\treturn 'http://127.0.0.1:' + port;\n\t}\n\n\tasync tabsExecuteScript(options) {\n\t\tif (this.browserSupportsPromises_) return this.browser().tabs.executeScript(options);\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.browser().tabs.executeScript(options, () => {\n\t\t\t\tconst e = this.browser().runtime.lastError;\n\t\t\t\tif (e) {\n\t\t\t\t\tconst msg = ['tabsExecuteScript: Cannot load ' + JSON.stringify(options)]\n\t\t\t\t\tif (e.message) msg.push(e.message);\n\t\t\t\t\treject(new Error(msg.join(': ')));\n\t\t\t\t}\n\t\t\t\tresolve();\n\t\t\t});\n\t\t})\n\t}\n\n\tasync tabsQuery(options) {\n\t\tif (this.browserSupportsPromises_) return this.browser().tabs.query(options);\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.browser().tabs.query(options, (tabs) => {\n\t\t\t\tresolve(tabs);\n\t\t\t});\n\t\t});\n\t}\n\n\tasync tabsSendMessage(tabId, command) {\n\t\tif (this.browserSupportsPromises_) return this.browser().tabs.sendMessage(tabId, command);\n\t\t\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.browser().tabs.sendMessage(tabId, command, (result) => {\n\t\t\t\tresolve(result);\n\t\t\t});\n\t\t});\n\t}\n\n\tasync tabsCreate(options) {\n\t\tif (this.browserSupportsPromises_) return this.browser().tabs.create(options);\n\t\t\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.browser().tabs.create(options, () => {\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t}\n\n\tasync folderTree() {\n\t\treturn this.clipperApiExec('GET', 'folders');\n\t}\n\n\tasync storageSet(keys) {\n\t\tif (this.browserSupportsPromises_) return this.browser().storage.local.set(keys);\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.browser().storage.local.set(keys, () => {\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t}\n\n\tasync storageGet(keys, defaultValue = null) {\n\t\tif (this.browserSupportsPromises_) {\n\t\t\ttry {\n\t\t\t\tconst r = await this.browser().storage.local.get(keys);\n\t\t\t\treturn r;\n\t\t\t} catch (error) {\n\t\t\t\treturn defaultValue;\n\t\t\t}\n\t\t} else {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tthis.browser().storage.local.get(keys, (result) => {\n\t\t\t\t\tresolve(result);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\tasync sendCommandToActiveTab(command) {\n\t\tconst tabs = await this.tabsQuery({ active: true, currentWindow: true });\n\t\tif (!tabs.length) {\n\t\t\tconsole.warn('No valid tab');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.dispatch({ type: 'CONTENT_UPLOAD', operation: null });\n\n\t\tconsole.info('Sending message ', command);\n\n\t\tawait this.tabsSendMessage(tabs[0].id, command);\n\t}\n\n\tasync clipperApiExec(method, path, query, body) {\n\t\tconsole.info('Popup: ' + method + ' ' + path);\n\n\t\tconst baseUrl = await this.clipperServerBaseUrl();\n\n\t\tconst fetchOptions = {\n\t\t\tmethod: method,\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/json'\n\t\t\t},\n\t\t}\n\n\t\tif (body) fetchOptions.body = typeof body === 'string' ? body : JSON.stringify(body);\n\n\t\tlet queryString = '';\n\t\tif (query) {\n\t\t\tconst s = [];\n\t\t\tfor (const k in query) {\n\t\t\t\tif (!query.hasOwnProperty(k)) continue;\n\t\t\t\ts.push(encodeURIComponent(k) + '=' + encodeURIComponent(query[k]));\n\t\t\t}\n\t\t\tqueryString = s.join('&');\n\t\t\tif (queryString) queryString = '?' + queryString;\n\t\t}\n\n\t\tconst response = await fetch(baseUrl + \"/\" + path + queryString, fetchOptions)\n\t\tif (!response.ok) {\n\t\t\tconst msg = await response.text();\n\t\t\tthrow new Error(msg);\n\t\t}\n\n\t\tconst json = await response.json();\n\t\treturn json;\n\t}\n\n\tasync sendContentToJoplin(content) {\n\t\tconsole.info('Popup: Sending to Joplin...');\n\n\t\ttry {\n\t\t\tthis.dispatch({ type: 'CONTENT_UPLOAD', operation: { uploading: true } });\n\n\t\t\tif (!content) throw new Error('Cannot send empty content');\n\n\t\t\t// There is a bug in Chrome that somehow makes the app send the same request twice, which\n\t\t\t// results in Joplin having the same note twice. There's a 2-3 sec delay between\n\t\t\t// each request. The bug only happens the first time the extension popup is open and the\n\t\t\t// Complete button is clicked.\n\t\t\t//\n\t\t\t// It's beyond my understanding how it's happening. I don't know how this sendContentToJoplin function\n\t\t\t// can be called twice. But even if it is, logically, it's impossible that this\n\t\t\t// call below would be done with twice the same nounce. Even if the function sendContentToJoplin\n\t\t\t// is called twice in parallel, the increment is atomic and should result in two nounces\n\t\t\t// being generated. But it's not. Somehow the function below is called twice with the exact same nounce.\n\t\t\t//\n\t\t\t// It's also not something internal to Chrome that repeat the request since the error is caught\n\t\t\t// so it really seems like a double function call.\n\t\t\t//\n\t\t\t// So this is why below, when we get the duplicate nounce error, we just ignore it so as not to display\n\t\t\t// a useless error message. The whole nounce feature is not for security (it's not to prevent replay\n\t\t\t// attacks), but simply to detect these double-requests and ignore them on Joplin side.\n\t\t\t//\n\t\t\t// This nounce feature is optional, it's only active when the nounce query parameter is provided\n\t\t\t// so it shouldn't affect any other call.\n\t\t\t//\n\t\t\t// This is the perfect Heisenbug - it happens always when opening the popup the first time EXCEPT\n\t\t\t// when the debugger is open. Then everything is working fine and the bug NEVER EVER happens,\n\t\t\t// so it's impossible to understand what's going on.\n\t\t\tawait this.clipperApiExec('POST', 'notes', { nounce: this.nounce_++ }, content);\n\n\t\t\tthis.dispatch({ type: 'CONTENT_UPLOAD', operation: { uploading: false, success: true } });\n\t\t} catch (error) {\n\t\t\tif (error.message === '{\"error\":\"Duplicate Nounce\"}') {\n\t\t\t\tthis.dispatch({ type: 'CONTENT_UPLOAD', operation: { uploading: false, success: true } });\n\t\t\t} else {\n\t\t\t\tthis.dispatch({ type: 'CONTENT_UPLOAD', operation: { uploading: false, success: false, errorMessage: error.message } });\n\t\t\t}\n\t\t}\n\t}\n\n}\n\nconst bridge_ = new Bridge();\n\nconst bridge = function() {\n\treturn bridge_;\n}\n\nexport { bridge }","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQlJREFUeNpiXOjAwMD3kcFcSMeyls/Jz/w/ExPjwyNbTz88d6iF5R/DUYYFNgzm16ri3v579fo/DPx79+7/6fq0j5N0GWxZJP6w1mv+EhRieP+CgeHXVwYGBkYGxu+fGUz+CPI9/8vaxCLHpWDGcPMmA8Oe7QwMikoMYPDwPgPD1UsMioIK+iwcfCKMDLo6DAxszAwMH95CFLAC2braDIxXPjEyPf32+iyDsgoDg6gEAwMnHwSLiDMwqKgz3Pv77jLT/ed3G89cP/qJgYWHgYFblIGBB4hZeBnO3zr+5eGTmw3MQRIMj288unTk5Yt7cn9+fRd8/fT2jxMHV5y4dGJzBvPf//sBAgwATg5okojpGQ0AAAAASUVORK5CYII=\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQlJREFUeNpi5FzIwCDKx2BuImRZa8vnZ874n4lx18Otp488PNTCwsJwlIFnAYN5xbW4t1/+vfoPA1//vftffTrto+gkBlsWMQnWemNNQaG3DC8ZvgEhIxB+ZfzMYGoiyLf5OWsTs1uV8kQR0X9cPxn+Mvxg+M7wjuEZwwOG0wyPGU4w/Pn9j59FlEOEUYRBh+EfAzPDZ4a3DBDAzCDKoM3Ay/iJkenu09dnRRlUGAQZJBh4GfjAWIBBnEGSQZ3hxr13l5l/Or6/x/FbMMRUyoCdHyjJxcAN1M/EsOH8ni/bLu/NYJRezMDw8Q2DjbWiWb2jspUxIyMjw6G7Jy4cfnC8iZWF4QBAgAEAwzdc4OHO/RAAAAAASUVORK5CYII=\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQVJREFUeNo0js1KAlEAhb87XsG0BkYHciEy/UBFQYuioaAnCHqEli16h7KGnqAnKFoFbaNtRGIwRVEgjKA2C5k0NNTMCPI2JB04cBYfh0+cOKD3sZOZ1V19dtNWQhN+8cL1S9eHEvIc72EXz7eag3ZD/WfQayn3bLt9tMO6TMtobk4aSb7r0PkEJRA/XZYThh7Eoo7Mjlgr1D0oXUJqkr+8VyF4YsKwFmUsbgqyCxCNwFdzCMhwZ+YRvY7Qat23e8xpSKQhog8bHw/fZqj0W89a9bV8cOflO6hR0FIhYIYeYzxUCh9+4O1LIVT+xj3dqDW83JS1thQqUvZvH1/8giMVV78CDAB2jGGahqf6iwAAAABJRU5ErkJggg==\"","function randomClipperPort(state, env) {\n\tconst startPorts = {\n\t\tprod: 41184,\n\t\tdev: 27583,\n\t};\n\n\tconst startPort = env === 'prod' ? startPorts.prod : startPorts.dev;\n\n\tif (!state) {\n\t\tstate = { offset: 0 };\n\t} else {\n\t\tstate.offset++;\n\t}\n\n\tstate.port = startPort + state.offset;\n\n\treturn state;\n}\n\nmodule.exports = randomClipperPort;","import React, { Component } from 'react';\nimport './App.css';\nimport led_red from './led_red.png';\nimport led_green from './led_green.png';\nimport led_orange from './led_orange.png';\n\nconst { connect } = require('react-redux');\nconst { bridge } = require('./bridge');\n\nclass PreviewComponent extends React.PureComponent {\n\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.bodyRef = React.createRef();\n\t}\n\n\tcomponentDidMount() {\n\t\t// Because the text size is made twice smaller with CSS, we need\n\t\t// to also reduce the size of the images\n\t\tconst imgs = this.bodyRef.current.getElementsByTagName('img');\n\t\tfor (const img of imgs) {\n\t\t\timg.width /= 2;\n\t\t\timg.height /= 2;\n\t\t}\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<div className=\"Preview\">\n\t\t\t\t<a className={\"Confirm Button\"} onClick={this.props.onConfirmClick}>Confirm</a>\n\t\t\t\t<h2>Preview:</h2>\n\t\t\t\t<input className={\"Title\"} value={this.props.title} onChange={this.props.onTitleChange}/>\n\t\t\t\t<div className={\"BodyWrapper\"}>\n\t\t\t\t\t<div className={\"Body\"} ref={this.bodyRef} dangerouslySetInnerHTML={{__html: this.props.body_html}}></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n\n}\n\nclass AppComponent extends Component {\n\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.state = ({\n\t\t\tcontentScriptLoaded: false,\n\t\t\tselectedTags: [],\n\t\t\tcontentScriptError: '',\n\t\t});\n\n\t\tthis.confirm_click = () => {\n\t\t\tconst content = Object.assign({}, this.props.clippedContent);\n\t\t\tcontent.tags = this.state.selectedTags.join(',');\n\t\t\tcontent.parent_id = this.props.selectedFolderId;\n\t\t\tbridge().sendContentToJoplin(content);\n\t\t}\n\n\t\tthis.contentTitle_change = (event) => {\n\t\t\tthis.props.dispatch({\n\t\t\t\ttype: 'CLIPPED_CONTENT_TITLE_SET',\n\t\t\t\ttext: event.currentTarget.value\n\t\t\t});\n\t\t}\n\n\t\tthis.clipSimplified_click = () => {\n\t\t\tbridge().sendCommandToActiveTab({\n\t\t\t\tname: 'simplifiedPageHtml',\n\t\t\t});\n\t\t}\n\n\t\tthis.clipComplete_click = () => {\n\t\t\tbridge().sendCommandToActiveTab({\n\t\t\t\tname: 'completePageHtml',\n\t\t\t});\n\t\t}\n\n\t\tthis.clipSelection_click = () => {\n\t\t\tbridge().sendCommandToActiveTab({\n\t\t\t\tname: 'selectedHtml',\n\t\t\t});\n\t\t}\n\n\t\tthis.clipUrl_click = () => {\n\t\t\tbridge().sendCommandToActiveTab({\n\t\t\t\tname: 'pageUrl',\n\t\t\t});\n\t\t}\n\n\t\tthis.clipScreenshot_click = async () => {\n\t\t\ttry {\n\t\t\t\tconst baseUrl = await bridge().clipperServerBaseUrl();\n\n\t\t\t\tawait bridge().sendCommandToActiveTab({\n\t\t\t\t\tname: 'screenshot',\n\t\t\t\t\tapi_base_url: baseUrl,\n\t\t\t\t\tparent_id: this.props.selectedFolderId,\n\t\t\t\t\ttags: this.state.selectedTags.join(','),\n\t\t\t\t});\n\n\t\t\t\twindow.close();\n\t\t\t} catch (error) {\n\t\t\t\tthis.props.dispatch({ type: 'CONTENT_UPLOAD', operation: { uploading: false, success: false, errorMessage: error.message } });\n\t\t\t}\n\t\t}\n\n\t\tthis.clipperServerHelpLink_click = () => {\n\t\t\tbridge().tabsCreate({ url: 'https://joplinapp.org/clipper/' });\n\t\t}\n\n\t\tthis.folderSelect_change = (event) => {\n\t\t\tthis.props.dispatch({\n\t\t\t\ttype: 'SELECTED_FOLDER_SET',\n\t\t\t\tid: event.target.value,\n\t\t\t});\n\t\t}\n\n\t\tthis.tagCompChanged = this.tagCompChanged.bind(this);\n\t\tthis.onAddTagClick = this.onAddTagClick.bind(this);\n\t\tthis.onClearTagButtonClick = this.onClearTagButtonClick.bind(this);\n\t}\n\n\tonAddTagClick(event) {\n\t\tconst newTags = this.state.selectedTags.slice();\n\t\tnewTags.push('');\n\t\tthis.setState({ selectedTags: newTags });\n\t\tthis.focusNewTagInput_ = true;\n\t}\n\n\tonClearTagButtonClick(event) {\n\t\tconst index = event.target.getAttribute('data-index');\n\t\tconst newTags = this.state.selectedTags.slice();\n\t\tnewTags.splice(index, 1);\n\t\tthis.setState({ selectedTags: newTags });\n\t}\n\n\ttagCompChanged(event) {\n\t\tconst index = Number(event.target.getAttribute('data-index'));\n\t\tconst value = event.target.value;\n\n\t\tif (this.state.selectedTags.length <= index) {\n\t\t\tconst newTags = this.state.selectedTags.slice();\n\t\t\tnewTags.push(value);\n\t\t\tthis.setState({ selectedTags: newTags });\n\t\t} else {\n\t\t\tif (this.state.selectedTags[index] !== value) {\n\t\t\t\tconst newTags = this.state.selectedTags.slice();\n\t\t\t\tnewTags[index] = value;\n\t\t\t\tthis.setState({ selectedTags: newTags });\t\t\t\t\n\t\t\t}\n\t\t}\n\t}\n\n\tasync loadContentScripts() {\n\t\tawait bridge().tabsExecuteScript({file: \"/content_scripts/JSDOMParser.js\"});\n\t\tawait bridge().tabsExecuteScript({file: \"/content_scripts/Readability.js\"});\n\t\tawait bridge().tabsExecuteScript({file: \"/content_scripts/Readability-readerable.js\"});\n\t\tawait bridge().tabsExecuteScript({file: \"/content_scripts/index.js\"});\n\t}\n\n\tasync componentDidMount() {\n\t\ttry {\n\t\t\tawait this.loadContentScripts();\n\t\t} catch (error) {\n\t\t\tconsole.error('Could not load content scripts', error);\n\t\t\tthis.setState({ contentScriptError: error.message });\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setState({\n\t\t\tcontentScriptLoaded: true,\n\t\t});\n\n\t\tlet foundSelectedFolderId = false;\n\n\t\tconst searchSelectedFolder = (folders) => {\n\t\t\tfor (let i = 0; i < folders.length; i++) {\n\t\t\t\tconst folder = folders[i];\n\t\t\t\tif (folder.id === this.props.selectedFolderId) foundSelectedFolderId = true;\n\t\t\t\tif (folder.children) searchSelectedFolder(folder.children);\n\t\t\t}\n\t\t}\n\n\t\tsearchSelectedFolder(this.props.folders);\n\n\t\tif (!foundSelectedFolderId) {\n\t\t\tconst newFolderId = this.props.folders.length ? this.props.folders[0].id : null;\n\t\t\tthis.props.dispatch({\n\t\t\t\ttype: 'SELECTED_FOLDER_SET',\n\t\t\t\tid: newFolderId,\n\t\t\t});\n\t\t}\n\n\t\tbridge().sendCommandToActiveTab({ name: 'isProbablyReaderable' });\n\t}\n\n\tcomponentDidUpdate() {\n\t\tif (this.focusNewTagInput_) {\n\t\t\tthis.focusNewTagInput_ = false;\n\t\t\tlet lastRef = null;\n\t\t\tfor (let i = 0; i < 100; i++) {\n\t\t\t\tconst ref = this.refs['tagSelector' + i];\n\t\t\t\tif (!ref) break;\n\t\t\t\tlastRef = ref;\n\t\t\t}\n\t\t\tif (lastRef) lastRef.focus();\n\t\t}\n\t}\n\n\trender() {\n\t\tif (!this.state.contentScriptLoaded) {\n\t\t\tlet msg = 'Loading...';\n\t\t\tif (this.state.contentScriptError) msg = 'The Joplin extension is not available on this tab due to: ' + this.state.contentScriptError;\n\t\t\treturn <div style={{padding: 10, fontSize: 12, maxWidth: 200}}>{msg}</div>;\n\t\t}\n\n\t\tconst warningComponent = !this.props.warning ? null : <div className=\"Warning\">{ this.props.warning }</div>\n\n\t\tconst hasContent = !!this.props.clippedContent;\n\t\tconst content = this.props.clippedContent;\n\n\t\tlet previewComponent = null;\n\n\t\tconst operation = this.props.contentUploadOperation;\n\n\t\tif (operation) {\n\t\t\tlet msg = '';\n\n\t\t\tif (operation.searchingClipperServer) {\n\t\t\t\tmsg = 'Searching clipper service... Please make sure that Joplin is running.';\n\t\t\t} else if (operation.uploading) {\n\t\t\t\tmsg = 'Processing note... The note will be available in Joplin as soon as the web page and images have been downloaded and converted. In the meantime you may close this popup.';\n\t\t\t} else if (operation.success) {\n\t\t\t\tmsg = 'Note was successfully created!';\n\t\t\t} else {\n\t\t\t\tmsg = 'There was some error creating the note: ' + operation.errorMessage;\n\t\t\t}\n\n\t\t\tpreviewComponent = (\n\t\t\t\t<div className=\"Preview\">\n\t\t\t\t\t<p className=\"Info\">{ msg }</p>\n\t\t\t\t</div>\n\t\t\t);\n\t\t} else if (hasContent) {\n\t\t\tpreviewComponent = <PreviewComponent\n\t\t\t\tonConfirmClick={this.confirm_click}\n\t\t\t\ttitle={content.title}\n\t\t\t\tbody_html={content.body_html}\n\t\t\t\tonTitleChange={this.contentTitle_change}\n\t\t\t/>\n\t\t}\n\n\t\tconst clipperStatusComp = () => {\n\n\t\t\tconst stateToString = function(state) {\n\t\t\t\tif (state === 'not_found') return 'Not found';\n\t\t\t\treturn state.charAt(0).toUpperCase() + state.slice(1);\n\t\t\t} \n\n\t\t\tlet msg = ''\n\t\t\tlet led = null;\n\t\t\tlet helpLink = null;\n\n\t\t\tconst foundState = this.props.clipperServer.foundState\n\t\t\t\n\t\t\tif (foundState === 'found') {\n\t\t\t\tmsg = \"Ready on port \" + this.props.clipperServer.port\n\t\t\t\tled = led_green\n\t\t\t} else {\n\t\t\t\tmsg = stateToString(foundState)\n\t\t\t\tled = foundState === 'searching' ? led_orange : led_red\n\t\t\t\tif (foundState === 'not_found') helpLink = <a className=\"Help\" onClick={this.clipperServerHelpLink_click} href=\"help\">[Help]</a>\n\t\t\t}\n\n\t\t\tmsg = \"Service status: \" + msg\n\n\t\t\treturn <div className=\"StatusBar\"><img alt={foundState} className=\"Led\" src={led}/><span className=\"ServerStatus\">{ msg }{ helpLink }</span></div>\n\t\t}\n\n\t\tconst foldersComp = () => {\n\t\t\tconst optionComps = [];\n\n\t\t\tconst nonBreakingSpacify = (s) => {\n\t\t\t\t// https://stackoverflow.com/a/24437562/561309\n\t\t\t\treturn s.replace(/ /g, \"\\u00a0\");\n\t\t\t}\n\n\t\t\tconst addOptions = (folders, depth) => {\n\t\t\t\tfor (let i = 0; i < folders.length; i++) {\n\t\t\t\t\tconst folder = folders[i];\n\t\t\t\t\toptionComps.push(<option key={folder.id} value={folder.id}>{nonBreakingSpacify('    '.repeat(depth) + folder.title)}</option>)\n\t\t\t\t\tif (folder.children) addOptions(folder.children, depth + 1);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\taddOptions(this.props.folders, 0);\n\n\t\t\treturn (\n\t\t\t\t<div className=\"Folders\">\n\t\t\t\t\t<label>In notebook: </label>\n\t\t\t\t\t<select value={this.props.selectedFolderId || ''} onChange={this.folderSelect_change}>\n\t\t\t\t\t\t{ optionComps }\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t);\n\t\t}\n\n\t\tconst tagsComp = () => {\n\t\t\tconst comps = [];\n\t\t\tfor (let i = 0; i < this.state.selectedTags.length; i++) {\n\t\t\t\tcomps.push(<div key={i}>\n\t\t\t\t\t<input\n\t\t\t\t\t\tref={'tagSelector' + i}\n\t\t\t\t\t\tdata-index={i}\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\tlist=\"tags\"\n\t\t\t\t\t\tvalue={this.state.selectedTags[i]}\n\t\t\t\t\t\tonChange={this.tagCompChanged}\n\t\t\t\t\t\tonInput={this.tagCompChanged}\n\t\t\t\t\t/>\n\t\t\t\t\t<a data-index={i} href=\"#\" className=\"ClearTagButton\" onClick={this.onClearTagButtonClick}>[x]</a>\n\t\t\t\t</div>);\n\t\t\t}\n\t\t\treturn (\n\t\t\t\t<div>\n\t\t\t\t\t{comps}\n\t\t\t\t\t<a className=\"AddTagButton\" href=\"#\" onClick={this.onAddTagClick}>Add tag</a>\n\t\t\t\t</div>\n\t\t\t);\n\t\t}\n\n\t\tconst tagDataListOptions = [];\n\t\tfor (let i = 0; i < this.props.tags.length; i++) {\n\t\t\tconst tag = this.props.tags[i];\n\t\t\ttagDataListOptions.push(<option key={tag.id}>{tag.title}</option>);\n\t\t}\n\n\t\tlet simplifiedPageButtonLabel = 'Clip simplified page';\n\t\tlet simplifiedPageButtonTooltip = '';\n\t\tif (!this.props.isProbablyReaderable) {\n\t\t\tsimplifiedPageButtonLabel += ' ⚠️';\n\t\t\tsimplifiedPageButtonTooltip = 'It might not be possible to create a good simplified version of this page.\\nYou may want to clip the complete page instead.';\n\t\t}\n\n\t\treturn (\n\t\t\t<div className=\"App\">\n\t\t\t\t<div className=\"Controls\">\t\t\t\n\t\t\t\t\t<ul>\n\t\t\t\t\t\t<li><a className=\"Button\" onClick={this.clipSimplified_click} title={simplifiedPageButtonTooltip}>{simplifiedPageButtonLabel}</a></li>\n\t\t\t\t\t\t<li><a className=\"Button\" onClick={this.clipComplete_click}>Clip complete page</a></li>\n\t\t\t\t\t\t<li><a className=\"Button\" onClick={this.clipSelection_click}>Clip selection</a></li>\n\t\t\t\t\t\t<li><a className=\"Button\" onClick={this.clipScreenshot_click}>Clip screenshot</a></li>\n\t\t\t\t\t\t<li><a className=\"Button\" onClick={this.clipUrl_click}>Clip URL</a></li>\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t\t{ foldersComp() }\n\t\t\t\t<div className=\"Tags\">\n\t\t\t\t\t<label>Tags:</label>\n\t\t\t\t\t{tagsComp()}\n\t\t\t\t\t<datalist id=\"tags\">\n\t\t\t\t\t\t{tagDataListOptions}\n\t\t\t\t\t</datalist>\n\t\t\t\t</div>\n\t\t\t\t{ warningComponent }\n\t\t\t\t{ previewComponent }\n\t\t\t\t{ clipperStatusComp() }\n\t\t\t</div>\n\t\t);\n\t}\n\n}\n\nconst mapStateToProps = (state) => {\n\treturn {\n\t\twarning: state.warning,\n\t\tclippedContent: state.clippedContent,\n\t\tcontentUploadOperation: state.contentUploadOperation,\n\t\tclipperServer: state.clipperServer,\n\t\tfolders: state.folders,\n\t\ttags: state.tags,\n\t\tselectedFolderId: state.selectedFolderId,\n\t\tisProbablyReaderable: state.isProbablyReaderable,\n\t};\n};\n\nconst App = connect(mapStateToProps)(AppComponent);\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nconst { Provider } = require('react-redux');\nconst { bridge } = require('./bridge');\nconst { createStore, applyMiddleware } = require('redux');\n\nconst defaultState = {\n\twarning: '',\n\tclippedContent: null,\n\tcontentUploadOperation: null,\n\tclipperServer: {\n\t\tfoundState: 'idle',\n\t\tport: null,\n\t},\n\tfolders: [],\n\ttags: [],\n\tselectedFolderId: null,\n\tenv: 'prod',\n\tisProbablyReaderable: true,\n};\n\nconst reduxMiddleware = store => next => async (action) => {\n\tconst result = next(action);\n\tconst newState = store.getState();\n\n\tif (['SELECTED_FOLDER_SET'].indexOf(action.type) >= 0) {\n\t\tbridge().scheduleStateSave(newState);\n\t}\n\n  \treturn result;\n}\n\nfunction reducer(state = defaultState, action) {\n\tlet newState = state;\n\n\tif (action.type === 'WARNING_SET') {\n\n\t\tnewState = Object.assign({}, state);\n\t\tnewState.warning = action.text;\n\n\t} else if (action.type === 'IS_PROBABLY_READERABLE') {\n\n\t\tnewState = Object.assign({}, state);\n\t\tnewState.isProbablyReaderable = action.value;\n\n\t} else if (action.type === 'CLIPPED_CONTENT_SET') {\n\n\t\tnewState = Object.assign({}, state);\n\t\tnewState.clippedContent = action.content;\n\n\t} else if (action.type === 'CLIPPED_CONTENT_TITLE_SET') {\n\n\t\tnewState = Object.assign({}, state);\n\t\tconst newContent = newState.clippedContent ? Object.assign({}, newState.clippedContent) : {};\n\t\tnewContent.title = action.text;\n\t\tnewState.clippedContent = newContent;\n\n\t} else if (action.type === 'CONTENT_UPLOAD') {\n\n\t\tnewState = Object.assign({}, state);\n\t\tnewState.contentUploadOperation = action.operation;\n\n\t} else if (action.type === 'FOLDERS_SET') {\n\n\t\tnewState = Object.assign({}, state);\n\t\tnewState.folders = action.folders;\n\n\t\tif (!newState.selectedFolderId && action.folders.length) {\n\t\t\tnewState.selectedFolderId = action.folders[0].id;\n\t\t}\n\n\t} else if (action.type === 'TAGS_SET') {\n\n\t\tnewState = Object.assign({}, state);\n\t\tnewState.tags = action.tags;\n\n\t} else if (action.type === 'SELECTED_FOLDER_SET') {\n\n\t\tnewState = Object.assign({}, state);\n\t\tnewState.selectedFolderId = action.id;\n\n\t} else if (action.type === 'CLIPPER_SERVER_SET') {\n\n\t\tnewState = Object.assign({}, state);\n\t\tconst clipperServer = Object.assign({}, newState.clipperServer);\n\t\tif ('foundState' in action) clipperServer.foundState = action.foundState;\n\t\tif ('port' in action) clipperServer.port = action.port;\n\t\tnewState.clipperServer = clipperServer;\n\n\t} else if (action.type === 'ENV_SET') {\n\n\t\tnewState = Object.assign({}, state);\n\t\tnewState.env = action.env;\n\n\t}\n\n\treturn newState;\n}\n\nasync function main() {\n\tconst store = createStore(reducer, applyMiddleware(reduxMiddleware));\n\n\tconsole.info('Popup: Init bridge and restore state...');\n\n\tawait bridge().init(window.browser ? window.browser : window.chrome, !!window.browser, store.dispatch);\n\n\tconsole.info('Popup: Creating React app...');\n\n\tReactDOM.render(<Provider store={store}><App /></Provider>, document.getElementById('root'));\n}\n\nmain().catch((error) => {\n\tconsole.error('Fatal error on initialisation:', error);\n});"],"sourceRoot":""}