"use strict";angular.module("MetronicApp").factory("RecipeService",["$window","$q","$http",function(r,t,n){var i,o,s=DM.globals.serverAPIURL;return{tryRecipesPromise:function(e){var r=e.results,n=e.tab.id,i=t.defer(),o={command:"tryRecipeTab",payload:{tab:n,communityRecipes:r.communityRecipes,userRecipes:r.userRecipes,mode:"try"}};return chrome.extension.sendRequest(o,function(r){r.error&&self.error(r.error),r.result.communityRecipes=r.result.communityRecipes.sort(function(e,r){return r.containerQuality-e.containerQuality||r.quality-e.quality}),e.results=r.result,i.resolve(e)}),i.promise},getRecipesPromise:function(r){var c,u=r.urlInfo,a=r.source,m=r.recipe_id,d=t.defer(),l=chrome.runtime.getManifest().version,p=chrome.extension.getBackgroundPage().dmBackground;return c=void 0!==m?s+"recipe/"+m+"/?":s+"recipe_list/"+u.domain+"/?",n({method:"GET",url:c+"user_id="+p.user.user_id+"&uid="+p.user.uid+"&v="+l+"&segment="+p.serverData.segment+"&yc="+p.counters.today_count+"&lc="+p.counters.total_count+"&token="+encodeURIComponent(p.counters.token)+"&install_date="+p.user.install_date||p.extension.install_date||"&source="+a+"&url="+encodeURIComponent(u.url).slice(0,1e3)}).then(function(e){if(200===e.status){var t=e.data;if(p.serverData=t,p.user.user_id=t.user_id,angular.forEach(t.userRecipes,function(e,r){e.data=JSON.parse(e.data)}),angular.forEach(t.communityRecipes,function(e,r){e.data=JSON.parse(e.data)}),t.communityRecipes&&(o=t.communityRecipes),t.userRecipes&&(i=t.userRecipes),t.communityRecipes&&(t.communityRecipes=$.grep(t.communityRecipes,function(e){if(void 0!==e.regex_domain&&""!==e.regex_domain){var r=new RegExp(e.regex_domain,"gi");return null!==u.domain.match(r)}return!1})),m){var n=[];void 0!==t.userRecipes&&(n=t.userRecipes.filter(function(e){return e.id===m})[0]),0===n.length&&void 0!==t.communityRecipes&&(n=t.communityRecipes.filter(function(e){return e.id===m})[0]),0===n.length&&(console.error(e),d.reject("Recipe ID "+m+" is not found. Perhaps the public recipe that you were using is deleted or not longer shared."))}r.results=t,d.resolve(r)}else console.error(e),d.reject("Something went wrong!!!")},function(r){console.error(e.stack||e),d.reject("Can not contact server: "+e.status+" "+e.statusText)}),d.promise},getRecipesCached:function(e,r,t){return{userRecipes:i,communityRecipes:o}}}}]);
//# sourceMappingURL=../../../../map/common/js/services/RecipeService.js.map